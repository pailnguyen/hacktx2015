<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-title" content="D2RotMan">
		<link rel="apple-touch-icon" sizes="57x57" href="img/app_icon.png">
		<link rel="apple-touch-icon" sizes="72x72" href="img/app_icon.png">
		<link rel="apple-touch-icon" sizes="114x114" href="img/app_icon.png">
		<link rel="apple-touch-icon" sizes="120x120" href="img/app_icon.png">
		<link rel="apple-touch-icon" sizes="144x144" href="img/app_icon.png">
		<link rel="apple-touch-icon" sizes="152x152" href="img/app_icon.png">
		<link rel="apple-touch-icon" sizes="180x180" href="img/app_icon.png">
		<link rel="apple-touch-icon-precomposed" href="img/app_icon.png">
		<title>Distance to RotMan</title>
		<link rel="stylesheet" type="text/css" href="css/normalize.css">
		<link rel="stylesheet" type="text/css" href="css/main.css">
		<script type="text/javascript" src="js/GreatCircle.js"></script>
		<script src="https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.js"></script>
		<link rel="stylesheet" href="https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.css">
	</head>
	<body>
		<div class="container">
			<header>
				<div class="title">Distance to RotMan</div>
				<div id="distance"></div>
				<div id="info1" class="distanceInfo"></div>
				<div id="info2" class="distanceInfo"></div>
			</header>
			<section class="content">
				<div id="map"></div>
				<p>Tap on the map pins to get more information about Xavier and Rohit's whereabouts. Pinch to zoom. If the map does not show up, ensure that location services are enabled on your device.</p>
				<h1>How does it work?</h1>
				<p>We calculate your distance to RotMan by gathering the GPS data on their phones via our satellite-sonar-geotracking algorithms. Now you can know where Xavier and Rohit are all the time!</p>
			</section>
			<footer>
				<p>Made with &#127828; by Austin A., Ayberk K., Laura L., Paul N., and Wendy L. for HackTX 2015. This web app uses the <a href="https://www.mapbox.com/">Mapbox mapping platform</a>.</p>
			</footer>
		</div>
		<script type="text/javascript">
			if (navigator.userAgent.indexOf('iPhone') != -1 || navigator.userAgent.indexOf('iPad') != -1) {
				if (navigator.standalone && navigator.geolocation) {
					console.log("case 1");
					run();
				}
				else {
					console.log("case 2");
					run();
					var div = document.getElementById("distance");
					div.innerHTML = "<p>The most advanced application of HackTX 2015. If you are on a smartphone/tablet, please add this web app to your home screen to begin. Make sure to have location services enabled.</p>";
					run();
				}
			}
			else if(navigator.geolocation) {
				console.log("case 3");
				run();
			}
			else {
				console.log("case 4");
				alert("Geolocation is not available!");
				var div = document.getElementById("distance");
				div.innerHTML = "<p>Your browser does not support geolocation.</p>";
			}
			function run() {
				userStrings = [
					"You are here! Just in case you got lost.",
					"Congratulations, you can find yourself on a map.",
					"Unfortunately, not everyone can be Xavier.",
					"This isn't the Rohit you're looking for.",
					"What starts here?",
					"Probably should go buy groceries right now..."
				];
				xavierStrings = [
					"seems to be lost...",
					"is looking for Rohit.",
					"is funding a tech startup.",
					"is looking for a nice spot to build a Chili's.",
					"Not shown: his Secret Service.",
					"is on his way to his bimonthly Illuminati meetings.",
					"is busy officiating a baptism.",
					"is busy actually having a life.",
					"takes himself VERY seriously."
				];
				rohitStrings = [
					"is enjoying a nice day in Austin.",
					"is looking for Xavier.",
					"is waiting for his Uber&trade;.",
					"has the strange feeling he's being tracked.",
					"is running a marathon.",
					"is meeting with Barack Obama!",
					"\"Hey Siri, where is the closest Arby's?\"",
					"is secretly the Green Power Ranger.",
					"can't find where he parked his car."
				];
				var geolocation = window.navigator.geolocation;
				// user = 1, Xavier = 2, Rohit = 3
				var lat1 = 0;
				var lon1 = 0;
				var lat2 = 30.389461136661513 + Math.random()*(30.185496022109444-30.389461136661513);
				var lon2 = -97.84629821777344 + Math.random()*(-97.61489868164062+97.84629821777344);
				var lat3 = 30.389461136661513 + Math.random()*(30.185496022109444-30.389461136661513);
				var lon3 = -97.84629821777344 + Math.random()*(-97.61489868164062+97.84629821777344);
				geolocation.getCurrentPosition(function(position) {
					// console.log(position);
					lat1 = position.coords.latitude;
					lon1 = position.coords.longitude;
					var distInMiles = GreatCircle.distance(lat1, lon1, lat2, lon2, "MI").toFixed(2)+" mi.";
					var distInMiles2 = GreatCircle.distance(lat1, lon1, lat3, lon3, "MI").toFixed(2)+" mi.";
					var distanceInfo1 = document.getElementById("info1");
					var distanceInfo2 = document.getElementById("info2");
					distanceInfo1.innerHTML = "<p>Your distance to <span class='name'>Xavier</span> is about " + distInMiles+"</p>";
					distanceInfo2.innerHTML = "<p>Your distance to <span class='name'>Rohit</span> is about " + distInMiles2+"</p>";
					L.mapbox.accessToken = 'pk.eyJ1IjoicGF1bG5ndXllbiIsImEiOiJjaWYzMzQwajcyODJ6dG1tNXNlMHJzYWFuIn0.qGMUxjZVpSBHdD0bile-4A';
					var map = L.mapbox.map('map', 'mapbox.streets')
						.setView([30.2865, -97.735], 11);
					// User
					L.mapbox.featureLayer({
						type: 'Feature',
						geometry: {
							type: 'Point',
							coordinates: [
							  lon1,
							  lat1					           
							]
						},
						properties: {
							title: "Your Location!",
							description: userStrings[Math.floor(Math.random()*userStrings.length)],
							'marker-size': 'large',
							'marker-color': '#DD0000',
							'marker-symbol': 'star'
						}
					}).addTo(map);
					// Xavier
					L.mapbox.featureLayer({
						type: 'Feature',
						geometry: {
							type: 'Point',
							coordinates: [
							  lon2,
							  lat2
							]
						},
						properties: {
							title: "Xavier Rotnofsky",
							description: xavierStrings[Math.floor(Math.random()*xavierStrings.length)],
							'marker-size': 'large',
							'marker-color': '#0000BB',
							'marker-symbol': 'cross'
						}
					}).addTo(map);
					// Rohit
					L.mapbox.featureLayer({
						type: 'Feature',
						geometry: {
							type: 'Point',
							coordinates: [
							  lon3,
							  lat3
							]
						},
						properties: {
							title: "Rohit Mandalapu",
							description: rohitStrings[Math.floor(Math.random()*rohitStrings.length)],
							'marker-size': 'large',
							'marker-color': '#00CC00',
							'marker-symbol': 'pitch'
						}
					}).addTo(map);
				})	
			}
		</script>
	</body>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-68160646-1', 'auto');
		ga('send', 'pageview');
	</script>
</html>